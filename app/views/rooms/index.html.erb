<div class="sidebar col-auto col-md-3 col-xl-2 bg-secondary">
  <%= render partial: 'layouts/sidebar', locals: { last_public_rooms: Room.public_rooms.last(5), last_users: User.last(5)} %>
</div>

<div id="chatroom_container" class="d-flex flex-column vh-100">
  <div class="room-container w-100 flex-grow-1 d-flex flex-column">
    <% if @single_room %>
      <div class="single-room-top text-center d-flex flex-row justify-content-center">
        <%= render partial: 'rooms/room_info/room_info_modal', locals: { room: @single_room, user: current_user } %>
        <%= render partial: 'rooms/room_info/room_settings_dropdown' %>
      </div>
      <div class="notifications">
        <%= turbo_stream_from "room_#{@single_room.id}_notifications" %>
      </div>
      <div id="single_room" data-controller="scroll" class="d-flex flex-column flex-grow-1">
        <%= turbo_stream_from @single_room %>
        <div id="messages" data-controller="message-context-menu">
          <div id="messages-container" data-action="contextmenu->message-context-menu#open">
              <%= turbo_frame_tag "page_handler" %>
              <%= render "messages/pager", pagy: @pagy %>
              <%= render partial: "messages/messages", locals: { messages: @messages } %>
          </div>
          <%= render partial: "rooms/context_menu" %>
        </div>
        <div class="form_fixed">
          <% if @single_room.participant?(current_user) %>
            <%= render partial: 'layouts/new_message_form' %>
          <% else %>
            <%=  form_with url: join_room_path, method: :post, local: true do %>
              <%=  hidden_field_tag :user_id, current_user.id  %>
              <%=  hidden_field_tag :id, @single_room.id  %>
              <%=  submit_tag "Join Room", class:"btn w-100 border"  %>
            <%  end  %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

</div>

<turbo-frame id="modal_frame"></turbo-frame>